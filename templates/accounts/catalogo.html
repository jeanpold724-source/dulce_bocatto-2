{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="catalogo-wrapper py-4">

  <!-- ENCABEZADO BONITO -->
  <div class="container mb-4">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
          <div>
            <h2 class="titulo-catalogo mb-1">
              Cat√°logo de Galletas üç™
            </h2>
            <p class="text-muted mb-0 subtitulo-catalogo">
              Elige tus sabores favoritos y selecciona cu√°ntas unidades quieres de cada una.
            </p>
          </div>
          <div class="etiqueta-info text-md-end">
            <span class="badge badge-pastel">
              Precio base: <strong>Bs {{ precio|default:10 }}</strong> c/u
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- LISTA DE SABORES -->
  <div class="container">
    {% if sabores %}
      <div class="row g-4 justify-content-center">
        {% for sabor in sabores %}
        <div class="col-12 col-sm-6 col-lg-4">
          <div class="card card-sabor h-100 border-0">
            
            <!-- IMAGEN -->
            <div class="ratio ratio-16x9 card-img-wrapper">
              {% if sabor.imagen %}
                <img src="{% static 'images/' %}{{ sabor.imagen }}" 
                     class="card-img-top object-fit-cover rounded-top-4"
                     alt="{{ sabor.nombre }}">
              {% elif sabor.imagen_url %}
                <img src="{{ sabor.imagen_url }}" 
                     class="card-img-top object-fit-cover rounded-top-4"
                     alt="{{ sabor.nombre }}">
              {% else %}
                <img src="{% static 'images/cookie.jpg' %}" 
                     class="card-img-top object-fit-cover rounded-top-4"
                     alt="{{ sabor.nombre }}">
              {% endif %}
            </div>

            <!-- CUERPO -->
            <div class="card-body d-flex flex-column">

              <div class="d-flex justify-content-between align-items-center mb-1">
                <h5 class="card-title mb-0 nombre-sabor">
                  üç™ {{ sabor.nombre }}
                </h5>
                <span class="precio-sabor">
                  Bs {{ precio|default:10 }}
                </span>
              </div>

              <p class="text-muted mb-3 texto-unitario">
                Precio por unidad ¬∑ Ideal para armar tu caja surtida ‚ú®
              </p>

              <!-- CANTIDAD -->
              <label class="form-label text-muted cantidad-label mb-1">
                Cantidad
              </label>
              <div class="input-group input-cantidad mb-3">
                <button class="btn btn-outline-secondary btn-cantidad" type="button" onclick="stepDown(this)">‚àí</button>
                <input id="qty-{{ sabor.id }}" 
                       type="number" 
                       value="1" 
                       min="1" 
                       max="99" 
                       class="form-control text-center">
                <button class="btn btn-outline-secondary btn-cantidad" type="button" onclick="stepUp(this)">+</button>
              </div>

              <!-- BOT√ìN -->
              <a class="btn btn-pastel w-100 mt-auto"
                 href="{% url 'crear_pedido' sabor.id %}?cantidad=1"
                 onclick="this.href=this.href.replace('cantidad=1','cantidad='+document.getElementById('qty-{{ sabor.id }}').value)">
                A√±adir al pedido
              </a>
            </div>

            <!-- FOOTER -->
            <div class="card-footer bg-white border-0 pt-0 pb-3 px-3">
              <span class="badge text-bg-success badge-disponible">Disponible</span>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <div class="alert alert-warning text-center shadow-sm rounded-4">
            Por ahora no hay galletas disponibles ü•∫. 
            <br>Vuelve pronto, estamos horneando nuevos sabores.
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<!-- JS para los botones + y - -->
<script>
  function stepUp(btn){
    btn.parentElement.querySelector('input[type=number]').stepUp();
  }
  function stepDown(btn){
    btn.parentElement.querySelector('input[type=number]').stepDown();
  }
</script>

<!-- ESTILOS PASTEL -->
<style>
  .catalogo-wrapper {
    background: #fff7fb;
    min-height: 100vh;
  }

  .titulo-catalogo {
    font-weight: 800;
    color: #5c3b2e; /* caf√© pastel */
  }

  .subtitulo-catalogo {
    font-size: 0.95rem;
  }

  .badge-pastel {
    background: #ffe3f1;
    color: #c24c7a;
    border-radius: 999px;
    padding: 0.45rem 0.9rem;
    font-size: 0.85rem;
  }

  /* Cards */
  .card-sabor {
    border-radius: 1.2rem;
    overflow: hidden;
    background: #ffffff;
    box-shadow: 0 5px 14px rgba(0,0,0,0.06);
    transition: transform 0.18s ease, box-shadow 0.18s ease;
  }

  .card-sabor:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 24px rgba(0,0,0,0.09);
  }

  .card-img-wrapper {
    --bs-aspect-ratio: 70%;
    background: #ffeaf5;
  }

  .object-fit-cover {
    object-fit: cover;
  }

  .nombre-sabor {
    font-weight: 700;
    color: #5c3b2e;
  }

  .precio-sabor {
    font-weight: 700;
    color: #ff6fa8;
    font-size: 1rem;
  }

  .texto-unitario {
    font-size: 0.85rem;
  }

  /* Cantidad */
  .cantidad-label {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .input-cantidad {
    max-width: 220px;
    border-radius: 999px;
    overflow: hidden;
    border: 1px solid #ffd1e5;
    background: #fff;
  }

  .input-cantidad input[type=number] {
    border: none !important;
    box-shadow: none !important;
  }

  .btn-cantidad {
    border: none !important;
    background: #ffe7f2;
    font-weight: 700;
  }

  .btn-cantidad:hover {
    background: #ffd1e5;
  }

  /* Bot√≥n pastel principal */
  .btn-pastel {
    background: linear-gradient(135deg,#ff82b4,#ff6fa8);
    border: none;
    color: #fff;
    font-weight: 600;
    border-radius: 999px;
    padding: 0.55rem 1rem;
    box-shadow: 0 4px 10px rgba(255,111,168,0.35);
  }

  .btn-pastel:hover {
    color: #fff;
    filter: brightness(1.05);
    box-shadow: 0 6px 12px rgba(255,111,168,0.45);
  }

  .badge-disponible {
    font-size: 0.75rem;
    border-radius: 999px;
    padding-inline: 0.75rem;
  }

  /* Responsive peque√±os ajustes */
  @media (max-width: 576px) {
    .titulo-catalogo {
      font-size: 1.4rem;
      text-align: center;
    }
    .subtitulo-catalogo {
      text-align: center;
    }
    .etiqueta-info {
      text-align: center !important;
    }
  }
</style>
{% endblock %}
